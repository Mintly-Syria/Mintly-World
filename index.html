<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mintly World - Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª - Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØµØ±Ù</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;700;900&display=swap" rel="stylesheet">

    <style>
        /* === Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† === */
        :root {
            /* Light Mode */
            --bg-body: #f0f2f5;
            --bg-card: #ffffff;
            --bg-header: #ffffff;
            --bg-input: #f4f6f8;
            --text-main: #2c3e50;
            --text-input: #2c3e50;
            --text-muted: #7f8c8d;
            --border: #e0e0e0;
            --accent: #d4a017; 
            --accent-hover: #b8940f;
            --accent-glow: rgba(212, 160, 23, 0.2);
            --result-color: #d4a017;
            --radius: 18px;
            --font-numbers: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --header-height: 80px;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --bg-body: #0f0f0f;
            --bg-card: #1a1a1a;
            --bg-header: #141414;
            --bg-input: #252525;
            --text-main: #ffd700;
            --text-input: #ffd700;
            --text-muted: #b0b0b0;
            --border: #333;
            --accent: #ffb700;
            --accent-hover: #ffcc00;
            --accent-glow: rgba(255, 183, 0, 0.15);
            --result-color: #ffd700;
            --shadow: 0 20px 40px rgba(0,0,0,0.7);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Cairo', 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-body);
            background-image: radial-gradient(circle at 50% -20%, var(--accent-glow) 0%, transparent 60%);
            background-attachment: fixed;
            color: var(--text-main);
            min-height: 100vh;
            width: 100%;
            padding-top: calc(var(--header-height) + 20px);
            padding-bottom: 20px;
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
        }

        /* === Header === */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--header-height);
            background-color: var(--bg-header);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: var(--shadow);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent);
            box-shadow: 0 0 15px var(--accent-glow);
            cursor: pointer;
            transition: transform 0.3s;
        }
        .header-logo:hover { transform: scale(1.05); }

        .brand-text {
            font-size: 1.2rem;
            font-weight: 900;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none; 
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 2000;
        }

        .control-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-main);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
        }
        .control-btn:hover {
            background-color: var(--bg-input);
            border-color: var(--accent);
            color: var(--accent);
        }
        
        /* --- Language Selector Styling (Fixed Centered) --- */
        .lang-select-wrapper {
            position: relative;
            user-select: none;
            width: 40px;
            height: 40px;
        }

        .lang-select-trigger {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-main);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .lang-select-trigger:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        .lang-select-trigger svg { width: 20px; height: 20px; fill: currentColor; }

        .lang-options {
            position: absolute;
            top: 55px;
            left: 50%;
            transform: translateX(-50%) scale(0.9);
            width: 220px;
            background: var(--bg-card);
            border: 2px solid var(--accent);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.2s cubic-bezier(0.165, 0.84, 0.44, 1);
            z-index: 2001;
            overflow: hidden;
            padding: 5px;
        }

        /* Active State */
        #langWrapper.open .lang-options {
            opacity: 1;
            visibility: visible;
            pointer-events: all;
            transform: translateX(-50%) scale(1);
        }

        .lang-option {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
            margin-bottom: 2px;
        }
        .lang-option:last-child { margin-bottom: 0; }
        .lang-option:hover { background-color: var(--accent-glow); }
        .lang-option img { width: 24px; height: 16px; border-radius: 2px; object-fit: cover; margin-inline-end: 10px; }
        .lang-option span { font-size: 0.9rem; font-weight: 600; }

        .header-nav {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            background: rgba(128, 128, 128, 0.1);
            border: 1px solid transparent;
            color: var(--text-muted);
            padding: 8px 14px;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .nav-btn.active {
            background: var(--accent);
            color: #000;
            box-shadow: 0 2px 10px var(--accent-glow);
            font-weight: 800;
        }

        /* === App Container === */
        .app-container {
            width: 100%;
            max-width: 480px;
            min-height: 60vh; 
            height: auto;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px; 
            box-shadow: var(--shadow);
            margin: 0 auto;
            position: relative;
            display: flex;
            flex-direction: column; 
            overflow: visible;
            transition: background-color 0.3s, border-color 0.3s;
        }

        h1 {
            text-align: center;
            font-weight: 900;
            font-size: 1.5rem; 
            margin-bottom: 15px; 
            color: var(--text-main);
            text-shadow: 0 0 10px var(--accent-glow);
            letter-spacing: -0.5px;
            flex-shrink: 0;
            user-select: none;
        }

        .view-section {
            display: none;
            flex-direction: column;
            height: auto;
            overflow: visible;
            position: relative;
        }
        
        .view-section.active-view {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scrollable-area {
            display: block;
            overflow: visible;
            height: auto;
            width: 100%;
        }
        
        .content-wrapper {
            display: flex;
            flex-direction: column;
            padding-bottom: 20px;
        }
        
        .input-group { margin-bottom: 10px; position: relative; }
        
        label {
            display: block;
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-bottom: 4px;
            font-weight: 600;
            user-select: none;
        }

        .styled-input {
            width: 100%;
            background: var(--bg-input);
            border: 2px solid var(--border);
            color: var(--text-input);
            padding: 12px 15px; 
            border-radius: var(--radius);
            font-size: 1.4rem;
            font-weight: 700;
            font-family: var(--font-numbers);
            direction: ltr;
            text-align: right;
            outline: none;
            transition: border-color 0.3s;
            -moz-appearance: textfield;
        }
        
        [dir="ltr"] .styled-input { text-align: left; }

        .styled-input::-webkit-outer-spin-button,
        .styled-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .styled-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .styled-select {
            width: 100%;
            background: var(--bg-input);
            border: 2px solid var(--border);
            color: var(--text-input);
            padding: 12px 15px; 
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            font-family: 'Cairo', sans-serif;
            outline: none;
            transition: border-color 0.3s;
            cursor: pointer;
        }
        .styled-select:focus { border-color: var(--accent); }

        .calc-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .calc-row .input-group { flex: 1; margin-bottom: 0; }

        .custom-select-wrapper { position: relative; user-select: none; width: 100%; z-index: 100; }
        .custom-select { position: relative; display: flex; flex-direction: column; }
        
        .custom-select__trigger {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px; 
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-main);
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
        }

        .custom-select__trigger:hover { border-color: var(--border); }
        .custom-select.open .custom-select__trigger {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .arrow { font-size: 0.7rem; color: var(--text-muted); transition: transform 0.3s; pointer-events: none;}
        .custom-select.open .arrow { transform: rotate(180deg); }

        .custom-options {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%;
            max-width: 450px;
            max-height: 80vh;
            background: var(--bg-card);
            border: 2px solid var(--accent);
            border-radius: 20px;
            box-shadow: 0 0 0 1000px rgba(0,0,0,0.8);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
            z-index: 99999;
            display: flex;
            flex-direction: column;
            padding-bottom: 10px;
            overflow-y: auto;
        }
        .custom-select.open .custom-options {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
            pointer-events: all;
        }
        .custom-options::-webkit-scrollbar { width: 8px; }
        .custom-options::-webkit-scrollbar-track { background: var(--bg-input); }
        .custom-options::-webkit-scrollbar-thumb { background-color: var(--accent); border-radius: 4px; }

        .currency-search-container {
            padding: 10px 15px;
            background: var(--bg-card);
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 1px solid var(--border);
        }
        .currency-search {
            width: 100%;
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-input);
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-family: 'Cairo', sans-serif;
            outline: none;
            transition: 0.3s;
        }
        .currency-search:focus { border-color: var(--accent); }

        .custom-option {
            position: relative;
            display: flex;
            align-items: center;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid rgba(128,128,128,0.1);
        }
        .custom-option:last-child { border-bottom: none; }
        .custom-option:hover {
            background-color: var(--accent-glow);
            color: var(--text-main);
            padding-right: 25px;
        }
        .custom-option.selected {
            color: var(--accent);
            background-color: var(--accent-glow);
        }

        .flag-icon {
            width: 32px;
            height: 24px;
            object-fit: contain; 
            border-radius: 4px;
            margin-left: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            background-color: #333;
            pointer-events: none;
        }
        [dir="ltr"] .flag-icon { margin-left: 0; margin-right: 15px; }

        .currency-text { flex: 1; text-align: right; direction: ltr; pointer-events: none;}
        [dir="ltr"] .currency-text { text-align: left; }
        
        .ar-name, .en-name {
            display: block;
            color: var(--text-muted);
            font-size: 0.8em;
            margin-top: 3px;
            direction: rtl; 
            text-align: right;
        }
        [dir="ltr"] .ar-name, [dir="ltr"] .en-name { direction: ltr; text-align: left; }

        .swap-row { display: flex; justify-content: center; margin: -5px 0 10px 0; position: relative; z-index: 1; }
        .btn-swap {
            width: 40px;
            height: 40px; 
            border-radius: 50%;
            background: var(--bg-card);
            border: 2px solid var(--border);
            color: var(--text-muted);
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .btn-swap:hover {
            color: var(--accent);
            border-color: var(--accent);
            transform: rotate(180deg) scale(1.1);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .footer-actions {
            margin-top: 20px; 
        }

        .btn-convert {
            width: 100%;
            padding: 14px; 
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            color: #000;
            border: none;
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            margin-top: 5px;
            box-shadow: 0 5px 15px -5px var(--accent-glow);
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
        }
        .btn-convert:active { transform: scale(0.98); }

        .result-box {
            margin-top: 10px; 
            padding-top: 15px;
            border-top: 1px solid var(--border);
            text-align: center;
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.5s;
        }
        .result-box.show { opacity: 1; transform: translateY(0); }
        
        /* === Styles for Dual Rate (USD) === */
        .dual-result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 10px;
            width: 100%;
        }

        .rate-card {
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 15px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, border-color 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .rate-card:hover { transform: translateY(-2px); }
        
        .rate-card.buy { border-color: rgba(46, 204, 113, 0.5); } /* Greenish border */
        .rate-card.sell { border-color: rgba(231, 76, 60, 0.5); } /* Reddish border */

        .rate-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .rate-value {
            font-size: 1.4rem;
            font-weight: 900;
            font-family: var(--font-numbers);
            direction: ltr;
            line-height: 1.2;
        }

        .rate-card.buy .rate-value { color: #2ecc71; text-shadow: 0 0 10px rgba(46, 204, 113, 0.2); } /* Green */
        .rate-card.sell .rate-value { color: #e74c3c; text-shadow: 0 0 10px rgba(231, 76, 60, 0.2); } /* Red */

        /* Single result style */
        .single-result-container {
            width: 100%;
            padding: 10px 0;
        }

        .result-amount {
            font-size: 2.2rem; 
            font-weight: 900;
            color: var(--result-color);
            line-height: 1.1;
            margin-bottom: 2px;
            text-shadow: 0 0 20px var(--accent-glow);
            font-family: var(--font-numbers);
            word-break: break-all;
        }

        .rate-display {
            font-size: 0.8rem;
            color: var(--text-muted);
            background: var(--bg-input);
            padding: 4px 12px;
            border-radius: 50px;
            border: 1px solid var(--border);
            display: inline-block;
            margin-top: 5px;
            direction: ltr;
        }

        .refresh-btn {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-bottom: 15px;
            align-self: flex-end;
            display: flex;
            align-items: center;
            gap: 5px;
            user-select: none;
        }
        .refresh-btn:hover { background: var(--accent); color: #000; }
        .refresh-btn svg { width: 14px; height: 14px; pointer-events: none; }

        .metal-card {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            user-select: none;
        }
        .metal-card.gold { border-color: #ffd700; }
        .metal-card.silver { border-color: #c0c0c0; }
        
        .metal-icon { font-size: 2rem; margin-bottom: 10px; }
        .metal-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 15px; }
        .gold .metal-title { color: #ffd700; }
        .silver .metal-title { color: #e0e0e0; }

        .price-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(128,128,128,0.1);
            font-family: var(--font-numbers);
            font-weight: 600;
        }
        .price-row:last-child { border-bottom: none; }
        .price-label { color: var(--text-muted); font-size: 0.9rem; }
        .price-value { font-size: 1rem; color: var(--text-main); }

        .crypto-list { display: flex; flex-direction: column; gap: 10px; padding-bottom: 20px; }
        .crypto-item {
            background: var(--bg-input);
            padding: 15px;
            border-radius: var(--radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
            user-select: none;
        }
        .crypto-info { display: flex; align-items: center; gap: 12px; }
        .crypto-icon { width: 36px; height: 36px; border-radius: 50%; background: #333; pointer-events: none;}
        .crypto-name { font-weight: 700; font-size: 1rem; color: var(--text-main); }
        .crypto-symbol { color: var(--text-muted); font-size: 0.8rem; }
        .crypto-price { 
            font-family: var(--font-numbers); 
            font-weight: 700; 
            color: var(--accent);
        }

        .live-indicator {
            font-size: 0.7rem;
            color: #0f0;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 10px;
            animation: blink 1.5s infinite;
        }
        @keyframes blink { 50% { opacity: 0.5; } }

        .loader {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,0.3);
            border-radius: 50%;
            border-top-color: #000;
            animation: spin 0.8s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            color: var(--text-main);
            border: 1px solid var(--accent);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 700;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            transition: 0.4s;
            z-index: 100000;
            font-size: 0.85rem;
            pointer-events: none;
        }
        .toast.active { transform: translateX(-50%) translateY(0); }

        .close-modal {
            text-align: center;
            padding: 15px;
            color: var(--accent);
            font-size: 1.2rem;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            margin-bottom: 0px;
            flex-shrink: 0;
            user-select: none;
        }
        .close-modal:active { opacity: 0.7; }
        
        .section-loader {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-muted);
            min-height: 200px;
        }
        
        @media (min-width: 400px) {
            .brand-text { display: block; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="main-header">
        <div class="header-left">
            
            <span class="brand-text">Mintly World</span>
        </div>
        
        <nav class="header-nav">
            <button class="nav-btn active" data-i18n="nav_currencies" onclick="switchView('home', this)">Ø¹Ù…Ù„Ø§Øª</button>
            <button class="nav-btn" data-i18n="nav_gold" onclick="switchView('gold', this)">Ø§Ù„Ø°Ù‡Ø¨</button>
            <button class="nav-btn" data-i18n="nav_crypto" onclick="switchView('crypto', this)">Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</button>
        </nav>

        <div class="header-controls">
            <!-- Language Selector (Fixed Centered) -->
            <div class="lang-select-wrapper" id="langWrapper">
                <div class="lang-select-trigger" id="langTrigger">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM11 19.93C7.05 19.44 4 16.08 4 12C4 11.38 4.08 10.79 4.21 10.21L9 15V16C9 17.1 9.9 18 11 18V19.93ZM17.9 17.39C17.64 16.8 16.9 16 16 16H15V13C15 12.45 14.55 12 14 12H8V10H10C10.55 10 11 9.55 11 9V7H13C14.1 7 15 6.1 15 5V4.59C17.93 5.78 20 8.65 20 12C20 14.08 19.2 15.97 17.9 17.39Z"/>
                    </svg>
                </div>
                <div class="lang-options" id="langOptions">
                    <!-- Populated by JS -->
                </div>
            </div>

            <button class="control-btn" id="themeToggle" onclick="toggleTheme()">
                <span id="themeIcon">â˜€ï¸</span>
            </button>
        </div>
    </header>

    <!-- App Container -->
    <div class="app-container">

        <!-- View 1: Converter -->
        <div id="view-home" class="view-section active-view">
            <h1 data-i18n="title_converter">Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</h1>
            
            <div class="scrollable-area">
                <div class="content-wrapper">
                    <div class="input-group">
                        <label data-i18n="label_amount">Ø§Ù„Ù…Ø¨Ù„Øº (Amount)</label>
                        <input type="number" id="amount" class="styled-input" value="100" placeholder="0.00" lang="en" inputmode="decimal">
                    </div>

                    <div class="input-group">
                        <label data-i18n="label_from">Ù…Ù† (From)</label>
                        <div class="custom-select-wrapper">
                            <div class="custom-select" id="fromSelect">
                                <div class="custom-select__trigger">
                                    <span data-i18n="select_currency">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø©</span>
                                    <span class="arrow">â–¼</span>
                                </div>
                                <div class="custom-options"></div>
                            </div>
                        </div>
                    </div>

                    <div class="swap-row">
                        <button class="btn-swap" id="swapBtn">â‡„</button>
                    </div>

                    <div class="input-group">
                        <label data-i18n="label_to">Ø¥Ù„Ù‰ (To)</label>
                        <div class="custom-select-wrapper">
                            <div class="custom-select" id="toSelect">
                                <div class="custom-select__trigger">
                                    <span data-i18n="select_currency">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø©</span>
                                    <span class="arrow">â–¼</span>
                                </div>
                                <div class="custom-options"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="footer-actions">
                <button class="btn-convert" id="convertBtn">
                    <span class="btn-text" data-i18n="btn_convert">ØªØ­ÙˆÙŠÙ„</span>
                    <div class="loader" id="loader"></div>
                </button>

                <div class="result-box" id="resultBox">
                    
                    <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø© (Ù„Ù„Ø¯ÙˆÙ„Ø§Ø± ÙÙ‚Ø·) -->
                    <div id="dualResult" style="display: none; width: 100%;">
                        <div class="dual-result-grid">
                            <div class="rate-card sell">
                                <span class="rate-label" data-i18n="price_sell">Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹</span>
                                <span class="rate-value" id="resSell">0.00</span>
                            </div>
                            <div class="rate-card buy">
                                <span class="rate-label" data-i18n="price_buy">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</span>
                                <span class="rate-value" id="resBuy">0.00</span>
                            </div>
                        </div>
                        <div class="rate-display" id="dualRateDisplay" lang="en">1 USD = --- USD</div>
                    </div>

                    <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ÙØ±Ø¯Ø© (Ù„Ù„Ø¨Ù‚ÙŠØ©) -->
                    <div id="singleResult" style="display: none; width: 100%;" class="single-result-container">
                        <div class="result-amount" id="resultAmount" lang="en">0.00</div>
                        <div class="rate-display" id="rateDisplay" lang="en">1 USD = --- USD</div>
                    </div>

                </div>
            </div>
        </div>

        <!-- View 2: Gold -->
        <div id="view-gold" class="view-section">
            <div style="display:flex; flex-direction:column; width:100%;">
                <div style="flex-shrink: 0;">
                    <h1 data-i18n="title_metals">Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ø¯Ù†</h1>
                    
                    <button class="refresh-btn" onclick="fetchGoldAndSilver()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        <span data-i18n="btn_refresh">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</span>
                    </button>
                </div>

                <div id="gold-loader-container" class="section-loader" style="display:none">
                    <div class="loader" style="display:block; border-top-color:var(--accent); border-color:rgba(212, 160, 23, 0.3);"></div>
                    <div style="margin: 0 10px" data-i18n="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„...</div>
                </div>

                <div class="scrollable-area">
                    <div id="gold-content" style="display:none;">
                        
                        <div class="metal-card gold" style="border-color: var(--accent);">
                            <div class="metal-title" data-i18n="title_calc">Ø­Ø§Ø³Ø¨Ø© Ù‚ÙŠÙ…Ø© Ø§Ù„Ø°Ù‡Ø¨</div>
                            
                            <div class="calc-row">
                                <div class="input-group">
                                    <label data-i18n="label_weight">Ø§Ù„ÙˆØ²Ù† (ØºØ±Ø§Ù…)</label>
                                    <input type="number" id="calc-weight" class="styled-input" placeholder="10" inputmode="decimal">
                                </div>
                                <div class="input-group">
                                    <label data-i18n="label_karat">Ø§Ù„Ø¹ÙŠØ§Ø±</label>
                                    <select id="calc-karat" class="styled-select">
                                        <option value="24">24K</option>
                                        <option value="22" selected>22K</option>
                                        <option value="21">21K</option>
                                        <option value="18">18K</option>
                                        <option value="14">14K</option>
                                    </select>
                                </div>
                            </div>

                            <div class="input-group">
                                <label data-i18n="label_currency">Ø§Ù„Ø¹Ù…Ù„Ø©</label>
                                <div class="custom-select-wrapper">
                                    <div class="custom-select" id="calcCurrencySelect">
                                        <div class="custom-select__trigger">
                                            <span data-i18n="select_currency">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø©</span>
                                            <span class="arrow">â–¼</span>
                                        </div>
                                        <div class="custom-options"></div>
                                    </div>
                                </div>
                            </div>

                            <button class="btn-convert" onclick="calculateGoldValue()" style="margin-top:15px;">
                                <span class="btn-text" data-i18n="btn_calc">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±</span>
                            </button>

                            <div class="result-box" id="calc-result-box" style="margin-top:15px; border-top:none; padding-top:5px;">
                                <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:5px;" data-i18n="label_approx">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©:</div>
                                <div class="result-amount" id="calc-result-amount" lang="en">0.00</div>
                                <div class="rate-display" id="calc-currency-label" style="margin-top:5px;">---</div>
                            </div>
                        </div>

                        <div class="metal-card gold">
                            <div class="metal-icon">ğŸ¥‡</div>
                            <div class="metal-title" data-i18n="market_prices">Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©</div>
                            
                            <div class="price-row">
                                <span class="price-label" data-i18n="ounce_usd">Ø£ÙˆÙ†ØµØ© (Ø¯ÙˆÙ„Ø§Ø±)</span>
                                <span class="price-value" id="gold-ounce-usd">---</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-i18n="gram_24_usd">ØºØ±Ø§Ù… 24 (Ø¯ÙˆÙ„Ø§Ø±)</span>
                                <span class="price-value" id="gold-gram-usd">---</span>
                            </div>
                            <div class="price-row" style="margin-top:5px; border-top:1px dashed var(--border); padding-top:5px;">
                                <span class="price-label" data-i18n="ounce_syp">Ø£ÙˆÙ†ØµØ© (Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ©)</span>
                                <span class="price-value" id="gold-ounce-syp" style="color:var(--accent)">---</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-i18n="gram_21_syp">ØºØ±Ø§Ù… 21 (Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ©)</span>
                                <span class="price-value" id="gold-21-syp" style="color:var(--accent)">---</span>
                            </div>
                        </div>

                        <div class="metal-card silver">
                            <div class="metal-icon">ğŸ¥ˆ</div>
                            <div class="metal-title" data-i18n="silver_title">Ø§Ù„ÙØ¶Ø© (Silver)</div>
                            
                            <div class="price-row">
                                <span class="price-label" data-i18n="ounce_usd">Ø£ÙˆÙ†ØµØ© (Ø¯ÙˆÙ„Ø§Ø±)</span>
                                <span class="price-value" id="silver-ounce-usd">---</span>
                            </div>
                            <div class="price-row">
                                <span class="price-label" data-i18n="gram_usd">ØºØ±Ø§Ù… (Ø¯ÙˆÙ„Ø§Ø±)</span>
                                <span class="price-value" id="silver-gram-usd">---</span>
                            </div>
                        </div>
                        
                        <p style="text-align:center; font-size:0.7rem; color:var(--text-muted); margin-top:20px; line-height:1.6; padding-bottom: 20px;">
                            * <span data-i18n="disclaimer">Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªÙØ¬Ù„Ø¨ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ø¯Ù‚ÙŠÙ‚Ø©.</span><br>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- View 3: Crypto -->
        <div id="view-crypto" class="view-section">
            <div style="display:flex; flex-direction:column; width:100%;">
                <div style="flex-shrink: 0;">
                    <h1 data-i18n="nav_crypto">Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h1>
                    
                    <div class="live-indicator" style="display:none" id="crypto-live-indicator">
                        <div style="width:8px; height:8px; background:#0f0; border-radius:50%"></div>
                        <span data-i18n="live_prices">Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</span>
                    </div>

                    <div id="crypto-loader-container" class="section-loader" style="display:none">
                        <div class="loader" style="display:block; border-top-color:var(--accent); border-color:rgba(212, 160, 23, 0.3);"></div>
                        <div style="margin: 0 10px" data-i18n="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ...</div>
                    </div>
                </div>

                <div class="scrollable-area">
                    <div class="crypto-list" id="cryptoListContainer">
                        <div style="text-align:center; padding:20px; color:var(--text-muted);" data-i18n="loading"> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª... </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="toast" id="toast">Alert Message</div>

    <script>
        // === Supported Languages ===
        const supportedLanguages = {
            ar: { name: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", flag: "sa" },
            en: { name: "English", flag: "us" },
            es: { name: "EspaÃ±ol", flag: "es" },
            fr: { name: "FranÃ§ais", flag: "fr" },
            de: { name: "Deutsch", flag: "de" },
            zh: { name: "ä¸­æ–‡", flag: "cn" },
            ja: { name: "æ—¥æœ¬èª", flag: "jp" },
            ru: { name: "Ğ ÑƒÑÑĞºĞ¸Ğ¹", flag: "ru" },
            pt: { name: "PortuguÃªs", flag: "pt" },
            hi: { name: "à¤¹à¤¿à¤¨à¥à¤¦à¥€", flag: "in" },
            it: { name: "Italiano", flag: "it" }
        };

        // === Full Translations ===
        const translations = {
            ar: {
                nav_currencies: "Ø¹Ù…Ù„Ø§Øª", nav_gold: "Ø§Ù„Ø°Ù‡Ø¨", nav_crypto: "Ø§Ù„Ø±Ù‚Ù…ÙŠØ©",
                title_converter: "Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª", label_amount: "Ø§Ù„Ù…Ø¨Ù„Øº (Amount)",
                select_currency: "Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…Ù„Ø©", label_from: "Ù…Ù† (From)", label_to: "Ø¥Ù„Ù‰ (To)",
                btn_convert: "ØªØ­ÙˆÙŠÙ„", title_metals: "Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ø¯Ù†", btn_refresh: "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†",
                loading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...", title_calc: "Ø­Ø§Ø³Ø¨Ø© Ù‚ÙŠÙ…Ø© Ø§Ù„Ø°Ù‡Ø¨",
                label_weight: "Ø§Ù„ÙˆØ²Ù† (ØºØ±Ø§Ù…)", label_karat: "Ø§Ù„Ø¹ÙŠØ§Ø±", label_currency: "Ø§Ù„Ø¹Ù…Ù„Ø©",
                btn_calc: "Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±", label_approx: "Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©:",
                market_prices: "Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©", ounce_usd: "Ø£ÙˆÙ†ØµØ© (Ø¯ÙˆÙ„Ø§Ø±)",
                gram_24_usd: "ØºØ±Ø§Ù… 24 (Ø¯ÙˆÙ„Ø§Ø±)", ounce_syp: "Ø£ÙˆÙ†ØµØ© (Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ©)",
                gram_21_syp: "ØºØ±Ø§Ù… 21 (Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ©)", silver_title: "Ø§Ù„ÙØ¶Ø© (Silver)",
                gram_usd: "ØºØ±Ø§Ù… (Ø¯ÙˆÙ„Ø§Ø±)", disclaimer: "Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªÙØ¬Ù„Ø¨ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ø¯Ù‚ÙŠÙ‚Ø©.",
                live_prices: "Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹",
                price_buy: "Ø´Ø±Ø§Ø¡ (Ù„Ù„Ø¹Ù…ÙŠÙ„)", price_sell: "Ù…Ø¨ÙŠØ¹ (Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„)"
            },
            en: {
                nav_currencies: "Currencies", nav_gold: "Gold", nav_crypto: "Crypto",
                title_converter: "Currency Converter", label_amount: "Amount",
                select_currency: "Select Currency", label_from: "From", label_to: "To",
                btn_convert: "Convert", title_metals: "Metal Prices", btn_refresh: "Refresh Now",
                loading: "Loading...", title_calc: "Gold Value Calculator",
                label_weight: "Weight (Grams)", label_karat: "Karat", label_currency: "Currency",
                btn_calc: "Calculate", label_approx: "Approx. Value:",
                market_prices: "Global Market Prices", ounce_usd: "Ounce (USD)",
                gram_24_usd: "Gram 24 (USD)", ounce_syp: "Ounce (SYP)",
                gram_21_syp: "Gram 21 (SYP)", silver_title: "Silver",
                gram_usd: "Gram (USD)", disclaimer: "Prices are fetched from reliable sources.",
                live_prices: "Live Prices Updating",
                price_buy: "Buy Rate (To You)", price_sell: "Sell Rate (From You)"
            },
            es: {
                nav_currencies: "Monedas", nav_gold: "Oro", nav_crypto: "Cripto",
                title_converter: "Conversor de Divisas", label_amount: "Cantidad",
                select_currency: "Seleccionar Moneda", label_from: "De", label_to: "A",
                btn_convert: "Convertir", title_metals: "Precios de Metales", btn_refresh: "Actualizar",
                loading: "Cargando...", title_calc: "Calculadora de Oro",
                label_weight: "Peso (Gramos)", label_karat: "Quilates", label_currency: "Moneda",
                btn_calc: "Calcular", label_approx: "Valor Aprox:",
                market_prices: "Precios Globales", ounce_usd: "Onza (USD)",
                gram_24_usd: "Gramo 24 (USD)", ounce_syp: "Onza (SYP)",
                gram_21_syp: "Gramo 21 (SYP)", silver_title: "Plata",
                gram_usd: "Gramo (USD)", disclaimer: "Los precios se obtienen de fuentes fiables.",
                live_prices: "ActualizaciÃ³n en vivo",
                price_buy: "Precio Compra", price_sell: "Precio Venta"
            },
            fr: {
                nav_currencies: "Devises", nav_gold: "Or", nav_crypto: "Crypto",
                title_converter: "Convertisseur de Devises", label_amount: "Montant",
                select_currency: "SÃ©lectionner Devise", label_from: "De", label_to: "Ã€",
                btn_convert: "Convertir", title_metals: "Prix des MÃ©taux", btn_refresh: "Actualiser",
                loading: "Chargement...", title_calc: "Calculateur d'Or",
                label_weight: "Poids (Grammes)", label_karat: "Carat", label_currency: "Devise",
                btn_calc: "Calculer", label_approx: "Valeur Approx:",
                market_prices: "Prix Mondiaux", ounce_usd: "Once (USD)",
                gram_24_usd: "Gramme 24 (USD)", ounce_syp: "Once (SYP)",
                gram_21_syp: "Gramme 21 (SYP)", silver_title: "Argent",
                gram_usd: "Gramme (USD)", disclaimer: "Les prix proviennent de sources fiables.",
                live_prices: "Mise Ã  jour en direct",
                price_buy: "Taux d'Achat", price_sell: "Taux de Vente"
            },
            de: {
                nav_currencies: "WÃ¤hrungen", nav_gold: "Gold", nav_crypto: "Krypto",
                title_converter: "WÃ¤hrungsrechner", label_amount: "Betrag",
                select_currency: "WÃ¤hrung wÃ¤hlen", label_from: "Von", label_to: "Nach",
                btn_convert: "Umrechnen", title_metals: "Edelmetallpreise", btn_refresh: "Aktualisieren",
                loading: "Laden...", title_calc: "Goldrechner",
                label_weight: "Gewicht (Gramm)", label_karat: "Karat", label_currency: "WÃ¤hrung",
                btn_calc: "Berechnen", label_approx: "UngefÃ¤hrer Wert:",
                market_prices: "Weltmarktpreise", ounce_usd: "Unze (USD)",
                gram_24_usd: "Gramm 24 (USD)", ounce_syp: "Unze (SYP)",
                gram_21_syp: "Gramm 21 (SYP)", silver_title: "Silber",
                gram_usd: "Gramm (USD)", disclaimer: "Preise werden von zuverlÃ¤ssigen Quellen bezogen.",
                live_prices: "Live-Aktualisierung",
                price_buy: "Kurskauf", price_sell: "Verkaufskurs"
            },
            zh: {
                nav_currencies: "è´§å¸", nav_gold: "é»„é‡‘", nav_crypto: "åŠ å¯†è´§å¸",
                title_converter: "è´§å¸è½¬æ¢å™¨", label_amount: "é‡‘é¢",
                select_currency: "é€‰æ‹©è´§å¸", label_from: "ä»", label_to: "åˆ°",
                btn_convert: "è½¬æ¢", title_metals: "é‡‘å±ä»·æ ¼", btn_refresh: "ç«‹å³åˆ·æ–°",
                loading: "åŠ è½½ä¸­...", title_calc: "é»„é‡‘ä»·å€¼è®¡ç®—å™¨",
                label_weight: "é‡é‡ï¼ˆå…‹ï¼‰", label_karat: "çº¯åº¦", label_currency: "è´§å¸",
                btn_calc: "è®¡ç®—", label_approx: "ä¼°ç®—å€¼:",
                market_prices: "å…¨çƒå¸‚åœºä»·æ ¼", ounce_usd: "ç›å¸ï¼ˆç¾å…ƒï¼‰",
                gram_24_usd: "å…‹ 24ï¼ˆç¾å…ƒï¼‰", ounce_syp: "ç›å¸ï¼ˆå™åˆ©äºšé•‘ï¼‰",
                gram_21_syp: "å…‹ 21ï¼ˆå™åˆ©äºšé•‘ï¼‰", silver_title: "ç™½é“¶",
                gram_usd: "å…‹ï¼ˆç¾å…ƒï¼‰", disclaimer: "ä»·æ ¼å–è‡ªå¯é æ¥æºã€‚",
                live_prices: "å®æ—¶ä»·æ ¼æ›´æ–°",
                price_buy: "ä¹°å…¥ä»·", price_sell: "å–å‡ºä»·"
            },
            ja: {
                nav_currencies: "é€šè²¨", nav_gold: "é‡‘", nav_crypto: "æš—å·è³‡ç”£",
                title_converter: "é€šè²¨ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼", label_amount: "é‡‘é¡",
                select_currency: "é€šè²¨ã‚’é¸æŠ", label_from: "ã‹ã‚‰", label_to: "ã¸",
                btn_convert: "å¤‰æ›", title_metals: "è²´é‡‘å±ä¾¡æ ¼", btn_refresh: "ä»Šã™ãæ›´æ–°",
                loading: "èª­ã¿è¾¼ã¿ä¸­...", title_calc: "ã‚´ãƒ¼ãƒ«ãƒ‰ä¾¡å€¤è¨ˆç®—æ©Ÿ",
                label_weight: "é‡ã•ï¼ˆã‚°ãƒ©ãƒ ï¼‰", label_karat: "ã‚«ãƒ©ãƒƒãƒˆ", label_currency: "é€šè²¨",
                btn_calc: "è¨ˆç®—ã™ã‚‹", label_approx: "æ¦‚ç®—ä¾¡å€¤:",
                market_prices: "ä¸–ç•Œå¸‚å ´ä¾¡æ ¼", ounce_usd: "ã‚ªãƒ³ã‚¹ (USD)",
                gram_24_usd: "ã‚°ãƒ©ãƒ  24 (USD)", ounce_syp: "ã‚ªãƒ³ã‚¹ (SYP)",
                gram_21_syp: "ã‚°ãƒ©ãƒ  21 (SYP)", silver_title: "ã‚·ãƒ«ãƒãƒ¼",
                gram_usd: "ã‚°ãƒ©ãƒ  (USD)", disclaimer: "ä¾¡æ ¼ã¯ä¿¡é ¼ã§ãã‚‹ã‚½ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã•ã‚Œã¾ã™ã€‚",
                live_prices: "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°",
                price_buy: "è²·ã„ãƒ¬ãƒ¼ãƒˆ", price_sell: "å£²ã‚Šãƒ¬ãƒ¼ãƒˆ"
            },
            ru: {
                nav_currencies: "Ğ’Ğ°Ğ»ÑÑ‚Ñ‹", nav_gold: "Ğ—Ğ¾Ğ»Ğ¾Ñ‚Ğ¾", nav_crypto: "ĞšÑ€Ğ¸Ğ¿Ñ‚Ğ¾",
                title_converter: "ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚ĞµÑ€ Ğ²Ğ°Ğ»ÑÑ‚", label_amount: "Ğ¡ÑƒĞ¼Ğ¼Ğ°",
                select_currency: "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ²Ğ°Ğ»ÑÑ‚Ñƒ", label_from: "ĞÑ‚", label_to: "Ğ’",
                btn_convert: "ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ", title_metals: "Ğ¦ĞµĞ½Ñ‹ Ğ½Ğ° Ğ¼ĞµÑ‚Ğ°Ğ»Ğ»Ñ‹", btn_refresh: "ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ",
                loading: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...", title_calc: "ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ·Ğ¾Ğ»Ğ¾Ñ‚Ğ°",
                label_weight: "Ğ’ĞµÑ (Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹)", label_karat: "ĞŸÑ€Ğ¾Ğ±Ğ°", label_currency: "Ğ’Ğ°Ğ»ÑÑ‚Ğ°",
                btn_calc: "Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ", label_approx: "ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ°Ñ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ:",
                market_prices: "ĞœĞ¸Ñ€Ğ¾Ğ²Ñ‹Ğµ Ñ€Ñ‹Ğ½Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ñ†ĞµĞ½Ñ‹", ounce_usd: "Ğ£Ğ½Ñ†Ğ¸Ñ (USD)",
                gram_24_usd: "Ğ“Ñ€Ğ°Ğ¼Ğ¼ 24 (USD)", ounce_syp: "Ğ£Ğ½Ñ†Ğ¸Ñ (SYP)",
                gram_21_syp: "Ğ“Ñ€Ğ°Ğ¼Ğ¼ 21 (SYP)", silver_title: "Ğ¡ĞµÑ€ĞµĞ±Ñ€Ğ¾",
                gram_usd: "Ğ“Ñ€Ğ°Ğ¼Ğ¼ (USD)", disclaimer: "Ğ¦ĞµĞ½Ñ‹ Ğ±ĞµÑ€ÑƒÑ‚ÑÑ Ğ¸Ğ· Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ñ‹Ñ… Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ².",
                live_prices: "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸",
                price_buy: "ĞšÑƒÑ€Ñ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸", price_sell: "ĞšÑƒÑ€Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸"
            },
            pt: {
                nav_currencies: "Moedas", nav_gold: "Ouro", nav_crypto: "Cripto",
                title_converter: "Conversor de Moedas", label_amount: "Quantidade",
                select_currency: "Selecione Moeda", label_from: "De", label_to: "Para",
                btn_convert: "Converter", title_metals: "PreÃ§os de Metais", btn_refresh: "Atualizar",
                loading: "Carregando...", title_calc: "Calculadora de Ouro",
                label_weight: "Peso (Gramas)", label_karat: "Quilates", label_currency: "Moeda",
                btn_calc: "Calcular", label_approx: "Valor Aprox:",
                market_prices: "PreÃ§os Globais", ounce_usd: "OnÃ§a (USD)",
                gram_24_usd: "Grama 24 (USD)", ounce_syp: "OnÃ§a (SYP)",
                gram_21_syp: "Grama 21 (SYP)", silver_title: "Prata",
                gram_usd: "Grama (USD)", disclaimer: "Os preÃ§os sÃ£o obtidos de fontes confiÃ¡veis.",
                live_prices: "AtualizaÃ§Ã£o ao vivo",
                price_buy: "Taxa de Compra", price_sell: "Taxa de Venda"
            },
            hi: {
                nav_currencies: "à¤®à¥à¤¦à¥à¤°à¤¾à¤à¤‚", nav_gold: "à¤¸à¥‹à¤¨à¤¾", nav_crypto: "à¤•à¥à¤°à¤¿à¤ªà¥à¤Ÿà¥‹",
                title_converter: "à¤®à¥à¤¦à¥à¤°à¤¾ à¤ªà¤°à¤¿à¤µà¤°à¥à¤¤à¤•", label_amount: "à¤°à¤¾à¤¶à¤¿",
                select_currency: "à¤®à¥à¤¦à¥à¤°à¤¾ à¤šà¥à¤¨à¥‡à¤‚", label_from: "à¤¸à¥‡", label_to: "à¤•à¥‡ à¤²à¤¿à¤",
                btn_convert: "à¤ªà¤°à¤¿à¤µà¤°à¥à¤¤à¤¿à¤¤ à¤•à¤°à¥‡à¤‚", title_metals: "à¤§à¤¾à¤¤à¥à¤“à¤‚ à¤•à¥€ à¤•à¥€à¤®à¤¤à¥‡à¤‚", btn_refresh: "à¤…à¤­à¥€ à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤•à¤°à¥‡à¤‚",
                loading: "à¤²à¥‹à¤¡ à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...", title_calc: "à¤¸à¥‹à¤¨à¤¾ à¤®à¥‚à¤²à¥à¤¯à¤¾à¤‚à¤•à¤¨",
                label_weight: "à¤µà¤œà¤¨ (à¤—à¥à¤°à¤¾à¤®)", label_karat: "à¤•à¥ˆà¤°à¥‡à¤Ÿ", label_currency: "à¤®à¥à¤¦à¥à¤°à¤¾",
                btn_calc: "à¤—à¤£à¤¨à¤¾ à¤•à¤°à¥‡à¤‚", label_approx: "à¤…à¤¨à¥à¤®à¤¾à¤¨à¤¿à¤¤ à¤®à¥‚à¤²à¥à¤¯:",
                market_prices: "à¤µà¥ˆà¤¶à¥à¤µà¤¿à¤• à¤¬à¤¾à¤œà¤¾à¤° à¤•à¥€à¤®à¤¤à¥‡à¤‚", ounce_usd: "à¤”à¤‚à¤¸ (USD)",
                gram_24_usd: "à¤—à¥à¤°à¤¾à¤® 24 (USD)", ounce_syp: "à¤”à¤‚à¤¸ (SYP)",
                gram_21_syp: "à¤—à¥à¤°à¤¾à¤® 21 (SYP)", silver_title: "à¤šà¤¾à¤‚à¤¦à¥€",
                gram_usd: "à¤—à¥à¤°à¤¾à¤® (USD)", disclaimer: "à¤•à¥€à¤®à¤¤à¥‡à¤‚ à¤µà¤¿à¤¶à¥à¤µà¤¸à¤¨à¥€à¤¯ à¤¸à¥à¤°à¥‹à¤¤à¥‹à¤‚ à¤¸à¥‡ à¤²à¥€ à¤—à¤ˆ à¤¹à¥ˆà¤‚à¥¤",
                live_prices: "à¤²à¤¾à¤‡à¤µ à¤…à¤ªà¤¡à¥‡à¤Ÿ",
                price_buy: "à¤–à¤°à¥€à¤¦ à¤¦à¤°", price_sell: "à¤¬à¤¿à¤•à¥à¤°à¥€ à¤¦à¤°"
            },
            it: {
                nav_currencies: "Valute", nav_gold: "Oro", nav_crypto: "Cripto",
                title_converter: "Convertitore di Valuta", label_amount: "Importo",
                select_currency: "Seleziona Valuta", label_from: "Da", label_to: "A",
                btn_convert: "Converti", title_metals: "Prezzi dei Metalli", btn_refresh: "Aggiorna",
                loading: "Caricamento...", title_calc: "Calcolatore Oro",
                label_weight: "Peso (Grammi)", label_karat: "Carati", label_currency: "Valuta",
                btn_calc: "Calcola", label_approx: "Valore Approssimativo:",
                market_prices: "Prezzi di Mercato Globali", ounce_usd: "Oncia (USD)",
                gram_24_usd: "Grammo 24 (USD)", ounce_syp: "Oncia (SYP)",
                gram_21_syp: "Grammo 21 (SYP)", silver_title: "Argento",
                gram_usd: "Grammo (USD)", disclaimer: "I prezzi vengono recuperati da fonti affidabili.",
                live_prices: "Aggiornamento dal vivo",
                price_buy: "Tasso di Acquisto", price_sell: "Tasso di Vendita"
            }
        };

        let currentLang = localStorage.getItem('appLang') || navigator.language.split('-')[0] || 'ar';
        if (!translations[currentLang]) currentLang = 'en';

        // === Language Logic ===
        function initLanguageSelector() {
            const container = document.getElementById('langOptions');
            let html = '';
            for (const [code, data] of Object.entries(supportedLanguages)) {
                html += `
                <div class="lang-option" onclick="setLanguage('${code}')">
                    <img src="https://flagcdn.com/w40/${data.flag}.png" alt="${data.flag}">
                    <span>${data.name}</span>
                </div>`;
            }
            container.innerHTML = html;

            const trigger = document.getElementById('langTrigger');
            const wrapper = document.getElementById('langWrapper');
            
            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                wrapper.classList.toggle('open');
            });
            
            window.addEventListener('click', () => {
                wrapper.classList.remove('open');
            });
        }

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('appLang', lang);
            applyLanguage(currentLang);
            
            const savedFrom = selectedFrom;
            const savedTo = selectedTo;
            const savedCalc = selectedCalcCurrency;

            if(currencyList && Object.keys(currencyList).length > 0) {
                initCustomSelects();
                initCalcCurrencySelect();
                
                setTimeout(() => {
                    selectOption('fromSelect', savedFrom);
                    selectOption('toSelect', savedTo);
                    selectOption('calcCurrencySelect', savedCalc);
                }, 50);
            }
        }

        function applyLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            
            const activeTrans = translations[lang] || translations['en'];

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (activeTrans[key]) el.textContent = activeTrans[key];
            });
        }

        // === Theme ===
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const iconSpan = document.getElementById('themeIcon');
            iconSpan.textContent = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        // === Data & APIs ===
        const API_ENDPOINTS = [
            "https://api.exchangerate-api.com/v4/latest/", 
            "https://open.er-api.com/v6/latest/"
        ];

        let selectedFrom = 'USD';
        let selectedTo = 'SYP'; // Changed to SYP to show the feature immediately
        let selectedCalcCurrency = 'SYP'; 
        let cachedRates = {}; 
        let sypRate = 0; 
        let cryptoInterval = null;
        let currentGoldPriceUsdPerGram = 0;
        let currencyList = {}; 

        const arabicNames = {
            AED: "Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ", AFN: "Ø£ÙØºØ§Ù†ÙŠ", ALL: "Ù„ÙŠÙƒ Ø£Ù„Ø¨Ø§Ù†ÙŠ", AMD: "Ø¯Ø±Ø§Ù… Ø£Ø±Ù…ÙŠÙ†ÙŠ", ANG: "Ø¬ÙŠÙ„Ø¯Ø± Ù‡ÙˆÙ„Ù†Ø¯ÙŠ", AOA: "ÙƒÙˆØ§Ù†Ø²Ø§ Ø£Ù†ØºÙˆÙ„ÙŠ", ARS: "Ø¨ÙŠØ²Ùˆ Ø£Ø±Ø¬Ù†ØªÙŠÙ†ÙŠ", AUD: "Ø¯ÙˆÙ„Ø§Ø± Ø£Ø³ØªØ±Ø§Ù„ÙŠ", AWG: "Ø¬ÙŠÙ„Ø¯Ø± Ø£Ø±ÙˆØ¨ÙŠ", AZN: "Ù…Ø§Ù†Ø§Øª Ø£Ø°Ø±Ø¨ÙŠØ¬Ø§Ù†ÙŠ",
            BAM: "Ù…Ø§Ø±Ùƒ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ­ÙˆÙŠÙ„", BBD: "Ø¯ÙˆÙ„Ø§Ø± Ø¨Ø±Ø¨Ø§Ø¯ÙˆØ³ÙŠ", BDT: "ØªØ§ÙƒØ§ Ø¨Ù†ØºÙ„Ø§Ø¯ÙŠØ´ÙŠ", BGN: "Ù„ÙŠÙ Ø¨Ù„ØºØ§Ø±ÙŠ", BHD: "Ø¯ÙŠÙ†Ø§Ø± Ø¨Ø­Ø±ÙŠÙ†ÙŠ", BIF: "ÙØ±Ù†Ùƒ Ø¨Ø±ÙˆÙ†Ø¯ÙŠ", BMD: "Ø¯ÙˆÙ„Ø§Ø± Ø¨Ø±Ù…ÙˆØ¯ÙŠ", BND: "Ø¯ÙˆÙ„Ø§Ø± Ø¨Ø±ÙˆÙ†ÙŠ", BOB: "Ø¨ÙˆÙ„ÙŠÙÙŠØ§Ù†Ùˆ", BRL: "Ø±ÙŠØ§Ù„ Ø¨Ø±Ø§Ø²ÙŠÙ„ÙŠ", BSD: "Ø¯ÙˆÙ„Ø§Ø± Ø¨Ù‡Ø§Ù…ÙŠ", BTC: "Ø¨ÙŠØªÙƒÙˆÙŠÙ†", BTN: "Ù†ØºÙ„ØªØ±ÙˆÙ… Ø¨ÙˆØªØ§Ù†ÙŠ", BWP: "Ø¨ÙˆÙ„Ø§ Ø¨ÙˆØªØ³ÙˆØ§Ù†ÙŠ", BYN: "Ø±ÙˆØ¨Ù„ Ø¨Ù„Ø§Ø±ÙˆØ³ÙŠ", BZD: "Ø¯ÙˆÙ„Ø§Ø± Ø¨Ù„ÙŠØ²ÙŠ",
            CAD: "Ø¯ÙˆÙ„Ø§Ø± ÙƒÙ†Ø¯ÙŠ", CDF: "ÙØ±Ù†Ùƒ ÙƒÙˆÙ†ØºÙˆÙ„ÙŠ", CHF: "ÙØ±Ù†Ùƒ Ø³ÙˆÙŠØ³Ø±ÙŠ", CLP: "Ø¨ÙŠØ²Ùˆ ØªØ´ÙŠÙ„ÙŠ", CNY: "ÙŠÙˆØ§Ù† ØµÙŠÙ†ÙŠ", COP: "Ø¨ÙŠØ²Ùˆ ÙƒÙˆÙ„ÙˆÙ…Ø¨ÙŠ", CRC: "ÙƒÙˆÙ„ÙˆÙ† ÙƒÙˆØ³ØªØ§Ø±ÙŠÙƒÙŠ", CUC: "Ø¨ÙŠØ²Ùˆ ÙƒÙˆØ¨ÙŠ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ­ÙˆÙŠÙ„", CUP: "Ø¨ÙŠØ²Ùˆ ÙƒÙˆØ¨ÙŠ", CVE: "Ø¥Ø³ÙƒÙˆØ¯Ùˆ Ø±Ø£Ø³ Ø£Ø®Ø¶Ø±ÙŠ", CZK: "ÙƒÙˆØ±ÙˆÙ†Ø§ ØªØ´ÙŠÙƒÙŠØ©",
            DJF: "ÙØ±Ù†Ùƒ Ø¬ÙŠØ¨ÙˆØªÙŠ", DKK: "ÙƒØ±ÙˆÙ†Ø© Ø¯Ø§Ù†Ù…Ø±ÙƒÙŠØ©", DOP: "Ø¨ÙŠØ²Ùˆ Ø¯ÙˆÙ…ÙŠÙ†ÙŠÙƒÙŠ", DZD: "Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ",
            EGP: "Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ", ERN: "Ù†Ø§Ù‚ÙØ§ Ø¥Ø±ÙŠØªØ±ÙŠ", ETB: "Ø¨ÙŠØ± Ø¥Ø«ÙŠÙˆØ¨ÙŠ", EUR: "ÙŠÙˆØ±Ùˆ",
            FJD: "Ø¯ÙˆÙ„Ø§Ø± ÙÙŠØ¬ÙŠ", FKP: "Ø¬Ù†ÙŠÙ‡ Ø¬Ø²Ø± ÙÙˆÙƒÙ„Ø§Ù†Ø¯", GBP: "Ø¬Ù†ÙŠÙ‡ Ø¥Ø³ØªØ±Ù„ÙŠÙ†ÙŠ", GEL: "Ù„Ø§Ø±ÙŠ Ø¬ÙˆØ±Ø¬ÙŠ", GGP: "Ø¬Ù†ÙŠÙ‡ ØºØ±Ù†Ø²ÙŠ", GHS: "Ø³ÙŠØ¯ÙŠ ØºØ§Ù†ÙŠ", GIP: "Ø¬Ù†ÙŠÙ‡ Ø¬Ø¨Ù„ Ø·Ø§Ø±Ù‚", GMD: "Ø¯Ø§Ù„Ø§Ø³ÙŠ ØºØ§Ù…Ø¨ÙŠ", GNF: "ÙØ±Ù†Ùƒ ØºÙŠÙ†ÙŠ", GTQ: "ÙƒÙŠØªØ²Ø§Ù„ ØºÙˆØ§ØªÙŠÙ…Ø§Ù„ÙŠ", GYD: "Ø¯ÙˆÙ„Ø§Ø± ØºÙŠØ§Ù†Ø§",
            HKD: "Ø¯ÙˆÙ„Ø§Ø± Ù‡ÙˆÙ†Øº ÙƒÙˆÙ†ØºÙŠ", HNL: "Ù„Ù…Ø¨ÙŠØ±Ø§ Ù‡Ù†Ø¯ÙˆØ±Ø§Ø³ÙŠØ©", HRK: "ÙƒÙˆÙ†Ø§ ÙƒØ±ÙˆØ§ØªÙŠØ©", HTG: "ØºÙˆØ±Ø¯ Ù‡Ø§ÙŠØªÙŠ", HUF: "ÙÙˆØ±Ù†Øª Ù…Ø¬Ø±ÙŠ",
            IDR: "Ø±ÙˆØ¨ÙŠØ© Ø¥Ù†Ø¯ÙˆÙ†ÙŠØ³ÙŠØ©", IMP: "Ø¬Ù†ÙŠÙ‡ Ù…Ø§Ù†", INR: "Ø±ÙˆØ¨ÙŠØ© Ù‡Ù†Ø¯ÙŠØ©", IQD: "Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ", IRR: "Ø±ÙŠØ§Ù„ Ø¥ÙŠØ±Ø§Ù†ÙŠ", ISK: "ÙƒØ±ÙˆÙ†Ø© Ø¢ÙŠØ³Ù„Ù†Ø¯ÙŠØ©", JEP: "Ø¬Ù†ÙŠÙ‡ Ø¬ÙŠØ±Ø²ÙŠ", JMD: "Ø¯ÙˆÙ„Ø§Ø± Ø¬Ø§Ù…Ø§ÙŠÙƒÙŠ", JOD: "Ø¯ÙŠÙ†Ø§Ø± Ø£Ø±Ø¯Ù†ÙŠ", JPY: "ÙŠÙ† ÙŠØ§Ø¨Ø§Ù†ÙŠ",
            KES: "Ø´Ù„Ù† ÙƒÙŠÙ†ÙŠ", KGS: "Ø³ÙˆÙ… Ù‚Ø±ØºÙŠØ²Ø³ØªØ§Ù†ÙŠ", KHR: "Ø±ÙŠÙŠÙ„ ÙƒÙ…Ø¨ÙˆØ¯ÙŠ", KMF: "ÙØ±Ù†Ùƒ Ù‚Ù…Ø±ÙŠ", KPW: "ÙˆÙˆÙ† ÙƒÙˆØ±ÙŠ Ø´Ù…Ø§Ù„ÙŠ", KRW: "ÙˆÙˆÙ† ÙƒÙˆØ±ÙŠ Ø¬Ù†ÙˆØ¨ÙŠ", KWD: "Ø¯ÙŠÙ†Ø§Ø± ÙƒÙˆÙŠØªÙŠ", KYD: "Ø¯ÙˆÙ„Ø§Ø± Ø¬Ø²Ø± ÙƒØ§ÙŠÙ…Ø§Ù†", KZT: "ØªÙŠÙ†Øº ÙƒØ§Ø²Ø§Ø®Ø³ØªØ§Ù†ÙŠ",
            LAK: "ÙƒÙŠØ¨ Ù„Ø§ÙˆØ³ÙŠ", LBP: "Ù„ÙŠØ±Ø© Ù„Ø¨Ù†Ø§Ù†ÙŠØ©", LKR: "Ø±ÙˆØ¨ÙŠØ© Ø³Ø±ÙŠÙ„Ø§Ù†ÙƒÙŠØ©", LRD: "Ø¯ÙˆÙ„Ø§Ø± Ù„ÙŠØ¨ÙŠØ±ÙŠ", LSL: "Ù„ÙˆØªÙŠ Ù„ÙŠØ³ÙˆØªÙˆ", LYD: "Ø¯ÙŠÙ†Ø§Ø± Ù„ÙŠØ¨ÙŠ",
            MAD: "Ø¯Ø±Ù‡Ù… Ù…ØºØ±Ø¨ÙŠ", MDL: "Ù„ÙŠÙˆ Ù…ÙˆÙ„Ø¯ÙˆÙÙŠ", MGA: "Ø£Ø±ÙŠØ§Ø±ÙŠ Ù…Ø¯ØºØ´Ù‚Ø±ÙŠ", MKD: "Ø¯ÙŠÙ†Ø§Ø± Ù…Ù‚Ø¯ÙˆÙ†ÙŠ", MMK: "ÙƒÙŠØ§Øª Ù…ÙŠØ§Ù†Ù…Ø§Ø±ÙŠ", MNT: "ØªÙˆØºØ±ÙŠÙƒ Ù…Ù†ØºÙˆÙ„ÙŠ", MOP: "Ø¨Ø§ØªØ§ÙƒØ§ Ù…Ø§ÙƒØ§ÙˆÙŠ", MRU: "Ø£ÙˆÙ‚ÙŠØ© Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ©", MUR: "Ø±ÙˆØ¨ÙŠØ© Ù…ÙˆØ±ÙŠØ´ÙŠÙˆØ³ÙŠØ©", MVR: "Ø±ÙˆÙÙŠÙŠØ© Ù…Ø§Ù„Ø¯ÙŠÙÙŠØ©", MWK: "ÙƒÙˆØ§Ø´Ø§ Ù…Ù„Ø§ÙˆÙŠ", MXN: "Ø¨ÙŠØ²Ùˆ Ù…ÙƒØ³ÙŠÙƒÙŠ", MYR: "Ø±ÙŠÙ†ØºÙŠØª Ù…Ø§Ù„ÙŠØ²ÙŠ", MZN: "Ù…ÙŠØªÙƒØ§Ù„ Ù…ÙˆØ²Ù…Ø¨ÙŠÙ‚ÙŠ",
            NAD: "Ø¯ÙˆÙ„Ø§Ø± Ù†Ø§Ù…ÙŠØ¨ÙŠ", NGN: "Ù†Ø§ÙŠØ±Ø§ Ù†ÙŠØ¬ÙŠØ±ÙŠ", NIO: "ÙƒÙˆØ±Ø¯ÙˆØ¨Ø§ Ù†ÙŠÙƒØ§Ø±Ø§ØºÙˆØ§", NOK: "ÙƒØ±ÙˆÙ†Ø© Ù†Ø±ÙˆÙŠØ¬ÙŠØ©", NPR: "Ø±ÙˆØ¨ÙŠØ© Ù†ÙŠØ¨Ø§Ù„ÙŠØ©", NZD: "Ø¯ÙˆÙ„Ø§Ø± Ù†ÙŠÙˆØ²ÙŠÙ„Ù†Ø¯ÙŠ",
            OMR: "Ø±ÙŠØ§Ù„ Ø¹Ù…Ø§Ù†ÙŠ",
            PAB: "Ø¨Ø§Ù„Ø¨ÙˆØ§ Ø¨Ù†Ù…ÙŠ", PEN: "Ø³ÙˆÙ„ Ø¨ÙŠØ±ÙˆÙÙŠ", PGK: "ÙƒÙŠÙ†Ø§ Ø¨Ø§Ø¨ÙˆØ§ ØºÙŠÙ†ÙŠØ§ Ø¬Ø¯ÙŠØ¯Ø©", PHP: "Ø¨ÙŠØ²Ùˆ ÙÙ„Ø¨ÙŠÙ†ÙŠ", PKR: "Ø±ÙˆØ¨ÙŠØ© Ø¨Ø§ÙƒØ³ØªØ§Ù†ÙŠØ©", PLN: "Ø²Ù„ÙˆØªÙŠ Ø¨ÙˆÙ„Ù†Ø¯ÙŠ", PYG: "ØºÙˆØ§Ø±Ø§Ù†ÙŠ Ø¨Ø§Ø±Ø§ØºÙˆØ§ÙŠ",
            QAR: "Ø±ÙŠØ§Ù„ Ù‚Ø·Ø±ÙŠ",
            RON: "Ù„ÙŠÙˆ Ø±ÙˆÙ…Ø§Ù†ÙŠ", RSD: "Ø¯ÙŠÙ†Ø§Ø± ØµØ±Ø¨ÙŠ", RUB: "Ø±ÙˆØ¨Ù„ Ø±ÙˆØ³ÙŠ", RWF: "ÙØ±Ù†Ùƒ Ø±ÙˆØ§Ù†Ø¯ÙŠ",
            SAR: "Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ", SBD: "Ø¯ÙˆÙ„Ø§Ø± Ø¬Ø²Ø± Ø³Ù„ÙŠÙ…Ø§Ù†", SCR: "Ø±ÙˆØ¨ÙŠØ© Ø³ÙŠØ´Ù„ÙŠØ©", SDG: "Ø¬Ù†ÙŠÙ‡ Ø³ÙˆØ¯Ø§Ù†ÙŠ", SEK: "ÙƒØ±ÙˆÙ†Ø© Ø³ÙˆÙŠØ¯ÙŠØ©", SGD: "Ø¯ÙˆÙ„Ø§Ø± Ø³Ù†ØºØ§ÙÙˆØ±ÙŠ", SHP: "Ø¬Ù†ÙŠÙ‡ Ø³Ø§Ù†Øª Ù‡ÙŠÙ„ÙŠÙ†", SLL: "Ù„ÙŠÙˆÙ† Ø³ÙŠØ±Ø§Ù„ÙŠÙˆÙ†", SOS: "Ø´Ù„Ù† ØµÙˆÙ…Ø§Ù„ÙŠ", SPL: "Ù„ÙˆØ¨ÙŠØºÙˆ", SRD: "Ø¯ÙˆÙ„Ø§Ø± Ø³ÙˆØ±ÙŠÙ†Ø§Ù…ÙŠ", STN: "Ø¯ÙˆØ¨Ø±Ø§ Ø³Ø§Ùˆ ØªÙˆÙ…ÙŠ", SVC: "ÙƒÙˆÙ„ÙˆÙ† Ø³Ù„ÙØ§Ø¯ÙˆØ±ÙŠ", SYP: "Ù„ÙŠØ±Ø© Ø³ÙˆØ±ÙŠØ©", SZL: "Ù„ÙŠÙ„Ø§Ù†Ø¬ÙŠÙ†ÙŠ Ø³ÙˆØ§Ø²ÙŠ",
            THB: "Ø¨Ø§Øª ØªØ§ÙŠÙ„Ø§Ù†Ø¯ÙŠ", TJS: "Ø³ÙˆÙ…ÙˆÙ†ÙŠ Ø·Ø§Ø¬ÙŠÙƒÙŠ", TMT: "Ù…Ù†Ø§Øª ØªØ±ÙƒÙ…Ø§Ù†Ø³ØªØ§Ù†ÙŠ", TND: "Ø¯ÙŠÙ†Ø§Ø± ØªÙˆÙ†Ø³ÙŠ", TOP: "Ø¨Ø§Ù†ØºØ§ ØªÙˆÙ†ØºÙŠ", TRY: "Ù„ÙŠØ±Ø© ØªØ±ÙƒÙŠØ©", TTD: "Ø¯ÙˆÙ„Ø§Ø± ØªØ±ÙŠÙ†ÙŠØ¯Ø§Ø¯ÙŠ", TVD: "Ø¯ÙˆÙ„Ø§Ø± ØªÙˆÙØ§Ù„Ùˆ", TWD: "Ø¯ÙˆÙ„Ø§Ø± ØªØ§ÙŠÙˆØ§Ù†ÙŠ Ø¬Ø¯ÙŠØ¯", TZS: "Ø´Ù„Ù† ØªÙ†Ø²Ø§Ù†ÙŠ",
            UAH: "Ù‡Ø±ÙŠÙÙ†ÙŠØ§ Ø£ÙˆÙƒØ±Ø§Ù†ÙŠØ©", UGX: "Ø´Ù„Ù† Ø£ÙˆØºÙ†Ø¯ÙŠ", USD: "Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ", UYU: "Ø¨ÙŠØ²Ùˆ Ø£ÙˆØ±ÙˆØºÙˆØ§ÙŠ", UZS: "Ø³ÙˆÙ… Ø£ÙˆØ²Ø¨ÙƒØ³ØªØ§Ù†ÙŠ",
            VEF: "Ø¨ÙˆÙ„ÙŠÙØ§Ø± ÙÙ†Ø²ÙˆÙŠÙ„ÙŠ", VND: "Ø¯ÙˆÙ†Ø¬ ÙÙŠØªÙ†Ø§Ù…ÙŠ", VUV: "ÙØ§ØªÙˆ ÙØ§Ù†ÙˆØ§ØªÙˆ",
            WST: "ØªØ§Ù„Ø§ Ø³Ø§Ù…ÙˆØ§",
            XAF: "ÙØ±Ù†Ùƒ CFA ÙˆØ³Ø· Ø£ÙØ±ÙŠÙ‚ÙŠØ§", XAG: "Ø£ÙˆÙ†ØµØ© ÙØ¶Ø©", XAU: "Ø£ÙˆÙ†ØµØ© Ø°Ù‡Ø¨", XBA: "ÙˆØ­Ø¯Ø© Ù…Ø±ÙƒØ¨Ø© Ø£ÙˆØ±ÙˆØ¨ÙŠØ©", XBB: "ÙˆØ­Ø¯Ø© Ù…Ø§Ù„ÙŠØ© Ø£ÙˆØ±ÙˆØ¨ÙŠØ©", XBC: "ÙˆØ­Ø¯Ø© Ø­Ø³Ø§Ø¨ÙŠØ© Ø£ÙˆØ±ÙˆØ¨ÙŠØ© (XBC)", XBD: "ÙˆØ­Ø¯Ø© Ø­Ø³Ø§Ø¨ÙŠØ© Ø£ÙˆØ±ÙˆØ¨ÙŠØ© (XBD)", XCD: "Ø¯ÙˆÙ„Ø§Ø± Ø´Ø±Ù‚ Ø§Ù„ÙƒØ§Ø±ÙŠØ¨ÙŠ", XDR: "Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø®Ø§ØµØ©", XOF: "ÙØ±Ù†Ùƒ CFA ØºØ±Ø¨ Ø£ÙØ±ÙŠÙ‚ÙŠØ§", XPD: "Ø£ÙˆÙ†ØµØ© Ø¨Ø§Ù„Ø§Ø¯ÙŠÙˆÙ…", XPF: "ÙØ±Ù†Ùƒ Ø³ÙŠ Ø¥Ù Ø¨ÙŠ", XPT: "Ø£ÙˆÙ†ØµØ© Ø¨Ù„Ø§ØªÙŠÙ†", XSU: "Ø³ÙˆÙƒØ±", XTS: "Ø±Ù…Ø² Ø¹Ù…Ù„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±", XUA: "ÙˆØ­Ø¯Ø© Ø­Ø³Ø§Ø¨ÙŠØ© Ø£Ø¯ÙŠØ³ Ø£Ø¨Ø§Ø¨Ø§", XXX: "Ø¹Ù…Ù„Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©",
            YER: "Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ",
            ZAR: "Ø±Ø§Ù†Ø¯ Ø¬Ù†ÙˆØ¨ Ø£ÙØ±ÙŠÙ‚ÙŠ", ZMW: "ÙƒÙˆØ§Ø´Ø§ Ø²Ø§Ù…Ø¨ÙŠ", ZWL: "Ø¯ÙˆÙ„Ø§Ø± Ø²ÙŠÙ…Ø¨Ø§Ø¨ÙˆÙŠ"
        };

        const amountInput = document.getElementById('amount');
        const convertBtn = document.getElementById('convertBtn');
        const swapBtn = document.getElementById('swapBtn');
        const loader = document.getElementById('loader');
        const btnText = document.querySelector('#convertBtn .btn-text');
        const resultBox = document.getElementById('resultBox');
        
        // Result Elements
        const singleResultDiv = document.getElementById('singleResult');
        const dualResultDiv = document.getElementById('dualResult');
        const resultAmount = document.getElementById('resultAmount');
        const resBuy = document.getElementById('resBuy');
        const resSell = document.getElementById('resSell');
        const rateDisplay = document.getElementById('rateDisplay');
        const dualRateDisplay = document.getElementById('dualRateDisplay');
        const toast = document.getElementById('toast');

        async function fetchRatesWithFallback(baseCurrency) {
            for (const apiUrl of API_ENDPOINTS) {
                try {
                    const response = await fetch(`${apiUrl}${baseCurrency}`, { cache: 'no-store' });
                    if (!response.ok) throw new Error("Network response was not ok");
                    const data = await response.json();
                    if (data.rates) return data.rates;
                } catch (error) {
                    continue;
                }
            }
            return null;
        }

        function switchView(viewName, btnElement) {
            if (viewName !== 'crypto' && cryptoInterval) {
                clearInterval(cryptoInterval);
                cryptoInterval = null;
                document.getElementById('crypto-live-indicator').style.display = 'none';
            }

            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));

            document.getElementById(`view-${viewName}`).classList.add('active-view');
            
            if(btnElement) btnElement.classList.add('active');
            else {
                const index = ['home', 'gold', 'crypto'].indexOf(viewName);
                if(index >= 0) document.querySelectorAll('.nav-btn')[index].classList.add('active');
            }

            if(viewName === 'gold') fetchGoldAndSilver();
            if(viewName === 'crypto') initCrypto();
        }

        document.addEventListener('DOMContentLoaded', async () => {
            initLanguageSelector(); 
            applyLanguage(currentLang); 
            await initCurrencies();
            
            convertBtn.addEventListener('click', performConvert);
            amountInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performConvert();
            });
            swapBtn.addEventListener('click', () => {
                swapBtn.style.transform = "rotate(180deg) scale(1.1)";
                setTimeout(() => swapBtn.style.transform = "rotate(0deg) scale(1)", 300);
                const temp = selectedFrom;
                selectOption('fromSelect', selectedTo);
                selectOption('toSelect', temp);
                performConvert();
            });
        });

        async function initCurrencies() {
            try {
                const rates = await fetchRatesWithFallback('USD');
                if (rates) {
                    Object.keys(rates).forEach(code => currencyList[code] = code);
                    cachedRates = rates;
                    sypRate = rates['SYP'];
                    initCustomSelects();
                    initCalcCurrencySelect();
                } else throw new Error("All APIs failed");
            } catch (e) {
                showToast(translations[currentLang]?.loading || "Error");
            }
        }

        function getIconUrl(code) {
            if (['XAU','XAG','BTC','ETH','XDR','XAF','XOF','XCD','XPF'].includes(code)) return 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
            if (code === 'ANG') return 'https://flagcdn.com/w40/nl.png';
            return `https://flagcdn.com/w40/${code.substring(0, 2).toLowerCase()}.png`;
        }

        function createListHTML() {
            let closeBtn = `<div class="close-modal">âœ• ${currentLang==='ar'?'Ø¥ØºÙ„Ø§Ù‚':'Close'}</div>`;
            let searchHTML = `<div class="currency-search-container"><input type="text" class="currency-search" placeholder="${currentLang === 'ar' ? 'Ø¨Ø­Ø«...' : 'Search...'}"></div>`;
            
            const codes = Object.keys(currencyList).filter(code => code !== 'ILS').sort();
            let list = codes.map(code => {
                const iconUrl = getIconUrl(code);
                const araName = arabicNames[code] || code;
                
                let htmlName = `<strong>${code}</strong>`;
                let htmlSub = ``;

                if(currentLang === 'ar') {
                    htmlName = `<strong>${code}</strong> <span class="ar-name">${araName}</span>`;
                } else {
                    htmlName = `<strong>${code}</strong>`;
                    htmlSub = `<span class="en-name">${araName}</span>`;
                }

                return `<span class="custom-option" data-value="${code}">
                        <img src="${iconUrl}" class="flag-icon">
                        <div class="currency-text">${htmlName} ${htmlSub}</div>
                    </span>`;
            }).join('');
            return closeBtn + searchHTML + list;
        }

        function initCustomSelects() {
            const listHTML = createListHTML();
            setupCustomSelect('fromSelect', listHTML, (val) => { selectedFrom = val; });
            setupCustomSelect('toSelect', listHTML, (val) => { selectedTo = val; });
            selectOption('fromSelect', 'USD'); // Default From USD
            selectOption('toSelect', 'SYP');    // Default To SYP (To show feature)
        }

        function initCalcCurrencySelect() {
            const listHTML = createListHTML();
            setupCustomSelect('calcCurrencySelect', listHTML, (val) => { selectedCalcCurrency = val; });
            setTimeout(() => selectOption('calcCurrencySelect', 'SYP'), 100);
        }

        function setupCustomSelect(elementId, htmlContent, callback) {
            const wrapper = document.getElementById(elementId);
            if(!wrapper) return;
            
            const trigger = wrapper.querySelector('.custom-select__trigger span:first-child');
            const optionsContainer = wrapper.querySelector('.custom-options');
            optionsContainer.innerHTML = htmlContent;

            const closeModal = () => {
                wrapper.classList.remove('open');
                wrapper.parentElement.style.zIndex = 1;
            };

            const openModal = () => {
                wrapper.classList.add('open');
                wrapper.parentElement.style.zIndex = 1000;
                const searchInput = optionsContainer.querySelector('.currency-search');
                if(searchInput) {
                    searchInput.value = '';
                    optionsContainer.querySelectorAll('.custom-option').forEach(opt => opt.style.display = 'flex');
                    searchInput.focus();
                }
            };

            // === FIX: Only attach trigger click listener once ===
            if (!wrapper.classList.contains('js-trigger-initialized')) {
                wrapper.querySelector('.custom-select__trigger').addEventListener('click', function(e) {
                    e.stopPropagation();
                    document.querySelectorAll('.custom-select').forEach(el => {
                        if (el !== wrapper) {
                            el.classList.remove('open');
                            el.parentElement.style.zIndex = 1;
                        }
                    });
                    if (wrapper.classList.contains('open')) closeModal();
                    else openModal();
                });
                wrapper.classList.add('js-trigger-initialized');
            }

            // Always re-attach listeners for the new dynamic content
            wrapper.querySelector('.close-modal')?.addEventListener('click', closeModal);
            
            const searchInput = optionsContainer.querySelector('.currency-search');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const term = e.target.value.toLowerCase();
                    optionsContainer.querySelectorAll('.custom-option').forEach(opt => {
                        const code = opt.dataset.value.toLowerCase();
                        const textContent = opt.textContent.toLowerCase();
                        opt.style.display = (code.includes(term) || textContent.includes(term)) ? 'flex' : 'none';
                    });
                });
            }

            wrapper.querySelectorAll('.custom-option').forEach(option => {
                option.addEventListener('click', function() {
                    const value = this.getAttribute('data-value');
                    const araName = arabicNames[value] || value;
                    const imgSrc = this.querySelector('img').src;

                    let htmlContent = '';
                    if (currentLang === 'ar') {
                        htmlContent = `<div style="display:flex; align-items:center;"><img src="${imgSrc}" class="flag-icon" style="width:18px; height:13px; margin-left:8px;">${value} - ${araName}</div>`;
                    } else {
                        htmlContent = `<div style="display:flex; align-items:center;"><img src="${imgSrc}" class="flag-icon" style="width:18px; height:13px; margin-left:0; margin-right:8px;">${value}</div>`;
                    }
                    trigger.innerHTML = htmlContent;
                    callback(value);
                    closeModal();
                });
            });
        }

        function selectOption(elementId, code) {
            const wrapper = document.getElementById(elementId);
            if(!wrapper) return;
            const option = wrapper.querySelector(`.custom-option[data-value="${code}"]`);
            if (option) option.click();
        }

        window.addEventListener('click', function(e) {
            if (!e.target.closest('.custom-select')) {
                document.querySelectorAll('.custom-select').forEach(el => {
                    el.classList.remove('open');
                    el.parentElement.style.zIndex = 1;
                });
            }
        });

        async function performConvert() {
            const amount = parseFloat(amountInput.value);
            if (isNaN(amount) || amount <= 0) {
                showToast(currentLang === 'ar' ? "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­" : "Please enter a valid amount");
                return;
            }
            resultBox.classList.remove('show');
            setLoading(true);

            try {
                // Fetch rates relative to the 'From' currency
                const rates = await fetchRatesWithFallback(selectedFrom);

                if (rates && rates[selectedTo]) {
                    const rate = rates[selectedTo]; // 1 From = X To
                    const totalMarket = amount * rate;
                    
                    setTimeout(() => {
                        // === MODIFICATION: STRICT USD CHECK ===
                        // Show Buy/Sell ONLY if converting FROM USD TO another currency
                        // (selectedTo !== 'USD' ensures we don't show it for USD->USD)
                        const isConvertingFromUSD = (selectedFrom === 'USD' && selectedTo !== 'USD');

                        if (isConvertingFromUSD) {
                            // Hide Single, Show Dual
                            singleResultDiv.style.display = 'none';
                            dualResultDiv.style.display = 'block';

                            // === Syrian Market Spread Logic ===
                            let spread = 0.015; // Default 1.5% for stable currencies

                            if (selectedTo === 'SYP') {
                                spread = 0.025; // 2.5% Spread for Syrian Pound
                            } else if (selectedTo === 'TRY') {
                                spread = 0.02; // 2% Spread for Turkish Lira
                            } else if (selectedTo === 'LBP') {
                                spread = 0.03; // 3% Spread for Lebanese Pound
                            }

                            // "Sell" (You sell USD): You get LESS
                            const totalSell = totalMarket * (1 - spread/2);
                            
                            // "Buy" (You buy currency): You pay MORE
                            const totalBuy = totalMarket * (1 + spread/2);

                            const formatNum = (num) => new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(num);

                            resSell.textContent = formatNum(totalSell);
                            resBuy.textContent = formatNum(totalBuy);
                            
                            // Update Rate Display Text
                            const lowRate = rate * (1 - spread/2);
                            const highRate = rate * (1 + spread/2);
                            dualRateDisplay.textContent = `1 ${selectedFrom} â‰ˆ ${lowRate.toFixed(4)} - ${highRate.toFixed(4)} ${selectedTo}`;

                        } else {
                            // Standard conversion for everything else (Non-USD or To-USD)
                            singleResultDiv.style.display = 'block';
                            dualResultDiv.style.display = 'none';
                            animateResult(totalMarket, rate);
                        }

                        resultBox.classList.add('show');
                    }, 200);

                } else {
                    showToast(currentLang === 'ar' ? "Ø§Ù„Ø¹Ù…Ù„Ø© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©" : "Currency not supported");
                }
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'ar' ? "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„" : "Connection Error");
            } finally {
                setLoading(false);
            }
        }

        function animateResult(targetValue, rate) {
            rateDisplay.textContent = `1 ${selectedFrom} = ${rate.toFixed(4)} ${selectedTo}`;
            const duration = 1500;
            const startValue = 0;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const ease = 1 - Math.pow(1 - progress, 3);
                const currentVal = startValue + (targetValue - startValue) * ease;
                const formatted = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(currentVal);
                resultAmount.textContent = formatted;
                if (progress < 1) requestAnimationFrame(update);
            }
            requestAnimationFrame(update);
        }

        function setLoading(isLoading) {
            convertBtn.disabled = isLoading;
            btnText.style.display = isLoading ? 'none' : 'block';
            loader.style.display = isLoading ? 'block' : 'none';
        }

        function showToast(msg) {
            toast.textContent = msg;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // === Gold Logic ===
        function calculateGoldValue() {
            const weight = parseFloat(document.getElementById('calc-weight').value);
            const karat = parseInt(document.getElementById('calc-karat').value);
            if (!weight || weight <= 0) {
                showToast(currentLang === 'ar' ? "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù†" : "Please enter weight");
                return;
            }
            if (currentGoldPriceUsdPerGram === 0) {
                showToast(currentLang === 'ar' ? "Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±..." : "Updating prices...");
                fetchGoldAndSilver();
                return;
            }
            const priceKaratUsd = (currentGoldPriceUsdPerGram * (karat / 24));
            let exchangeRate = selectedCalcCurrency === 'USD' ? 1 : (cachedRates[selectedCalcCurrency] || 1);
            const totalValue = weight * priceKaratUsd * exchangeRate;

            const resultBox = document.getElementById('calc-result-box');
            const resultAmount = document.getElementById('calc-result-amount');
            const currencyLabel = document.getElementById('calc-currency-label');

            let formattedValue = (['SYP','LBP','IQD'].includes(selectedCalcCurrency)) 
                ? new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(totalValue)
                : new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(totalValue);

            resultAmount.textContent = formattedValue;
            currencyLabel.textContent = selectedCalcCurrency;
            resultBox.classList.add('show');
        }

        async function fetchGoldAndSilver() {
            const loaderContainer = document.getElementById('gold-loader-container');
            const content = document.getElementById('gold-content');
            loaderContainer.style.display = 'flex';
            content.style.display = 'none';
            let goldUsdPerOunce = null;
            let silverUsdPerOunce = null;

            try {
                const rates = await fetchRatesWithFallback('USD');
                if (rates) {
                    if(rates['SYP']) { sypRate = rates['SYP']; cachedRates = rates; }
                    goldUsdPerOunce = rates['XAU'];
                    silverUsdPerOunce = rates['XAG'];
                }
                if (!goldUsdPerOunce) {
                    try {
                        const paxgRes = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=PAXGUSDT');
                        const paxgData = await paxgRes.json();
                        goldUsdPerOunce = parseFloat(paxgData.price);
                    } catch (e) {}
                }
                if (goldUsdPerOunce) {
                    currentGoldPriceUsdPerGram = goldUsdPerOunce / 31.1035;
                    document.getElementById('gold-ounce-usd').textContent = `$${goldUsdPerOunce.toLocaleString(undefined, {minimumFractionDigits:2})}`;
                    document.getElementById('gold-gram-usd').textContent = `$${(goldUsdPerOunce / 31.1035).toFixed(2)}`;
                    document.getElementById('gold-ounce-syp').textContent = sypRate ? (goldUsdPerOunce * sypRate).toLocaleString('en-US', {maximumFractionDigits:0}) : '---';
                    document.getElementById('gold-21-syp').textContent = sypRate ? ((goldUsdPerOunce * sypRate / 31.1035) * (21/24)).toLocaleString('en-US', {maximumFractionDigits:0}) : '---';
                    
                    if (silverUsdPerOunce) {
                        document.getElementById('silver-ounce-usd').textContent = `$${silverUsdPerOunce.toFixed(2)}`;
                        document.getElementById('silver-gram-usd').textContent = `$${(silverUsdPerOunce / 31.1035).toFixed(3)}`;
                        document.querySelector('.metal-card.silver').style.display = 'block';
                    } else document.querySelector('.metal-card.silver').style.display = 'none';
                    
                    loaderContainer.style.display = 'none';
                    content.style.display = 'block';
                } else throw new Error("Gold failed");
            } catch (error) {
                loaderContainer.style.display = 'none';
                content.style.display = 'block';
                showToast(currentLang === 'ar' ? "ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±" : "Price update failed");
            }
        }

        // === Crypto Logic ===
        async function fetchCryptoDataArray() {
            const response = await fetch('https://api.binance.com/api/v3/ticker/price', { cache: 'no-store' });
            if(!response.ok) throw new Error("API Error");
            const data = await response.json();
            const targetSymbols = ['BTCUSDT', 'ETHUSDT', 'BNBUSDT', 'SOLUSDT', 'XRPUSDT', 'DOGEUSDT', 'ADAUSDT', 'TRXUSDT', 'TONUSDT', 'PEPEUSDT'];
            return data.filter(item => targetSymbols.includes(item.symbol));
        }

        function buildCryptoHTML(coinsData) {
            const container = document.getElementById('cryptoListContainer');
            const cryptoNames = {
                'BTC': {ar:'Ø¨ÙŠØªÙƒÙˆÙŠÙ†', en:'Bitcoin', es:'Bitcoin', fr:'Bitcoin', de:'Bitcoin', zh:'æ¯”ç‰¹å¸', ja:'ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³', ru:'Ğ‘Ğ¸Ñ‚ĞºĞ¾Ğ¸Ğ½', pt:'Bitcoin', hi:'à¤¬à¤¿à¤Ÿà¤•à¥‰à¤‡à¤¨', it:'Bitcoin'}, 
                'ETH': {ar:'Ø¥ÙŠØ«ÙŠØ±ÙŠÙˆÙ…', en:'Ethereum', es:'Ethereum', fr:'Ethereum', de:'Ethereum', zh:'ä»¥å¤ªåŠ', ja:'ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ', ru:'Ğ­Ñ„Ğ¸Ñ€', pt:'Ethereum', hi:'à¤à¤¥à¥‡à¤°à¤¿à¤¯à¤®', it:'Ethereum'}, 
                'BNB': {ar:'Ø¨ÙŠÙ†Ø§Ù†Ø³', en:'Binance', es:'Binance', fr:'Binance', de:'Binance', zh:'å¸å®‰', ja:'ãƒã‚¤ãƒŠãƒ³ã‚¹', ru:'Binance', pt:'Binance', hi:'Binance', it:'Binance'},
                'SOL': {ar:'Ø³ÙˆÙ„Ø§Ù†Ø§', en:'Solana', es:'Solana', fr:'Solana', de:'Solana', zh:'ç´¢æ‹‰çº³', ja:'ã‚½ãƒ©ãƒŠ', ru:'Solana', pt:'Solana', hi:'à¤¸à¥‹à¤²à¤¾à¤¨à¤¾', it:'Solana'}, 
                'XRP': {ar:'Ø±ÙŠØ¨Ù„', en:'Ripple', es:'Ripple', fr:'Ripple', de:'Ripple', zh:'ç‘æ³¢å¸', ja:'ãƒªãƒƒãƒ—ãƒ«', ru:'Ripple', pt:'Ripple', hi:'à¤°à¤¿à¤ªà¤²', it:'Ripple'}, 
                'DOGE': {ar:'Ø¯ÙˆØ¬ ÙƒÙˆÙŠÙ†', en:'Dogecoin', es:'Dogecoin', fr:'Dogecoin', de:'Dogecoin', zh:'ç‹—ç‹—å¸', ja:'ãƒ‰ãƒ¼ã‚¸ã‚³ã‚¤ãƒ³', ru:'Dogecoin', pt:'Dogecoin', hi:'à¤¡à¥‰à¤—à¤•à¥‰à¤‡à¤¨', it:'Dogecoin'},
                'ADA': {ar:'ÙƒØ§Ø±Ø¯Ø§Ù†Ùˆ', en:'Cardano', es:'Cardano', fr:'Cardano', de:'Cardano', zh:'è‰¾è¾¾å¸', ja:'ã‚«ãƒ«ãƒ€ãƒ', ru:'ĞšĞ°Ñ€Ğ´Ğ°Ğ½Ğ¾', pt:'Cardano', hi:'à¤•à¤¾à¤°à¥à¤¡à¤¾à¤¨à¥‹', it:'Cardano'}, 
                'TRX': {ar:'ØªØ±ÙˆÙ†', en:'Tron', es:'Tron', fr:'Tron', de:'Tron', zh:'æ³¢åœº', ja:'ãƒˆãƒ­ãƒ³', ru:'Ğ¢Ñ€Ğ¾Ğ½', pt:'Tron', hi:'à¤Ÿà¥à¤°à¥‰à¤¨', it:'Tron'}, 
                'TON': {ar:'ØªÙˆÙ†', en:'Toncoin', es:'Toncoin', fr:'Toncoin', de:'Toncoin', zh:'Toncoin', ja:'ãƒˆãƒ³ã‚³ã‚¤ãƒ³', ru:'Toncoin', pt:'Toncoin', hi:'à¤Ÿà¤¨à¤•à¥‰à¤‡à¤¨', it:'Toncoin'}, 
                'PEPE': {ar:'Ø¨ÙŠØ¨ÙŠ', en:'Pepe', es:'Pepe', fr:'Pepe', de:'Pepe', zh:'Pepe', ja:'Pepe', ru:'Pepe', pt:'Pepe', hi:'Pepe', it:'Pepe'}
            };
            let html = '';
            coinsData.forEach(coin => {
                const symbol = coin.symbol.replace('USDT', '');
                const nameObj = cryptoNames[symbol] || {ar: symbol, en: symbol};
                const name = nameObj[currentLang] || nameObj['en'];
                const price = parseFloat(coin.price);
                const iconUrl = `https://assets.coincap.io/assets/icons/${symbol.toLowerCase()}@2x.png`;
                let formattedPrice = price < 1 ? price.toFixed(6) : price.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
                html += `<div class="crypto-item"><div class="crypto-info"><img src="${iconUrl}" class="crypto-icon" onerror="this.src='https://cdn-icons-png.flaticon.com/512/6146/6146332.png'"><div><div class="crypto-name">${name}</div><div class="crypto-symbol">${symbol}/USDT</div></div></div><div class="crypto-price" id="crypto-price-${symbol}">$${formattedPrice}</div></div>`;
            });
            container.innerHTML = html;
        }

        async function updateCryptoPrices() {
            try {
                const coinsData = await fetchCryptoDataArray();
                coinsData.forEach(coin => {
                    const symbol = coin.symbol.replace('USDT', '');
                    const price = parseFloat(coin.price);
                    const priceEl = document.getElementById(`crypto-price-${symbol}`);
                    if (priceEl) {
                        let formattedPrice = price < 1 ? price.toFixed(6) : price.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
                        priceEl.textContent = `$${formattedPrice}`;
                    }
                });
            } catch (error) {}
        }

        async function initCrypto() {
            const container = document.getElementById('cryptoListContainer');
            const loaderContainer = document.getElementById('crypto-loader-container');
            const liveIndicator = document.getElementById('crypto-live-indicator');
            if(cryptoInterval) clearInterval(cryptoInterval);
            const isAlreadyBuilt = document.getElementById('crypto-price-BTC') !== null;

            if (!isAlreadyBuilt) {
                loaderContainer.style.display = 'flex';
                container.innerHTML = '';
                try {
                    const data = await fetchCryptoDataArray();
                    buildCryptoHTML(data);
                    loaderContainer.style.display = 'none';
                    liveIndicator.style.display = 'flex';
                } catch (e) {
                    loaderContainer.style.display = 'none';
                    container.innerHTML = '<div style="text-align:center; padding:20px; color:var(--accent)">Connection Failed</div>';
                    return;
                }
            } else {
                liveIndicator.style.display = 'flex';
            }
            cryptoInterval = setInterval(updateCryptoPrices, 100);
        }

    </script>
</body>
</html>
